<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>我的订单</title>
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/order.css">
</head>
<body>
<!--快速导航栏-->
<div class="shortcut w">

    <ul class="fl city">
        <li>
            <a href="#">南京</a>
    </ul>
    <ul class="fr">
        <li>
            <a href="./login.html">你好，请登录 </a>
            <a href="./register.html" class="f10">免费注册</a>
        <li class="space">
        <li>
            <a href="order.html">我的订单</a>
        <li class="space">
        <li>
            <a href="shopping-cart2.html">我的购物车</a>
        <li class="space">
        <li>
            <a href="favourite1.html">我的收藏</a>
        <li class="space">
        <li>
            <a href="personal.html">个人中心</a>
    </ul>
</div>
<div align="center">
    <img src="../img/5.png"/>
</div>
<div id="title">
    <div class="checkedAll">
        <input type="checkbox" class="box1"/>
    </div>
    <div class="m">
        <p id="all">全选</p>
    </div>
    <div class="m">
        <p id="time">时间</p>
    </div>
    <div class="m">
        <p id="info">订单详情</p>
    </div>
    <div class="m">
        <p id="man">收货人</p>
    </div>
    <div class="m">
        <p id="value">单价</p>
    </div>
    <div class="m">
        <p id="num">数量</p>
    </div>
    <div class="m">
        <p id="state">状态</p>
    </div>
    <div class="m">
        <p id="operate">操作</p>
    </div>
</div>
<div class="marks">
    <!--<div class="mark">
        <div class="click">
            <input type="checkbox" name="newlist" id="newslist-1"/>
        </div>
        <p class="time" >2018.1.15</p>
        <div class="stuff">
            <img src="../img/img2.jpg" usemap="#goods" class="pic"/>
            <map name="goods" id="goods">
                <area shape="default" href="goods.html" />
            </map>
            <div class="dis">
                <a href="goods.html">旺仔小馒头清新诱人的花香，芬芳瞬间带来甜蜜的恋爱感觉！范思哲（versace）晶钻女用香水90ml，
                </a>
            </div>
            <div class="user">
                <span class="name">海绵宝宝</span>
            </div>
            <div class="value">
                <label class="price">500</label>
            </div>
            <div class="state">
                <label class="situation">待付款</label>
            </div>
            <div class="dele">
                <a href="#">删除</a>
            </div>
            <div class="pay">
                <a href="#">付款</a>
            </div>
        </div>
    </div>-->
</div>
<div id="tail">
    <div id="subvalue">
        <p class="subvalue">总价:</p>
    </div>
    <div id="subtotal">
        <p class="subtotal">￥<label class="total"></label></p>
        <a id="op" href="#">提交订单</a>
    </div>
</div>
</body>
<script src="../js/jquery-3.2.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // 全选
        $(".checkedAll").click(function () {

            if ($(this).attr("checked")) {
                $(".mark input[name=newslist]").each(function () {
                    $(this).attr("checked", true);
                });
                GetCount();

            } else {
                $(".mark input[name=newlist]").each(function () {
                    if ($(this).attr("checked")) {
                        $(this).attr("checked", false);
                    } else {
                        $(this).attr("checked", true);
                    }
                });
                GetCount();
            }

        });

        $(".mark input[name=newslist]").click(function () {
            alert("2222");
            GetCount();
        });
    });

    function GetCount() {
        var conts = 0;
        $(".mark input[name=newslist]").each(function () {
            if ($(this).attr("checked")) {
                conts += parseInt($(this).val());
            }
        });
        $("#subtotal").html((conts).toFixed(2));
    }


    $.ajax({
        type: "post",
        url: "/order/lookorder",
        data: {orderId: 1},
        async: false,
        dataType: "json",
        success: function (data) {
            if (data.code == 1) {
                var result = data.data;
                var total = 0;
                for (var i = 0; i < result.length; i++) {
                    var str = '' +
                        '<div class="mark">\n' +
                        '<div class="click">\n' +
                        '<input type="checkbox" name="newlist" class="checkbox" id="newslist-' + i + '"/>\n' +
                        '</div>\n' +
                        '<p class="time" >' + formatLocalDate(result[i].time) + '</p>\n' +
                        '<div class="stuff">\n' +
                        '<img src="' + result[i].img + '" usemap="#goods" class="pic"/>\n' +
                        '<map name="goods" id="goods">\n' +
                        '<area shape="default" href="goods.html" />\n' +
                        '</map>\n' +
                        '<div class="dis">\n' +
                        '<a href="goods.html">' + result[i].description + '\n' +
                        '</a>\n' +
                        '</div>\n' +
                        '<div class="user">\n' +
                        '<span class="name">' + result[i].username + '</span>\n' +
                        '</div>\n' +
                        '<div class="value">\n' +
                        '<label class="price">' + result[i].price + '</label>\n' +
                        '</div>\n' +
                        '<div class="num">\n' +
                        '<label class="number">' + result[i].good_num + '</label>\n' +
                        '</div>\n' +
                        '<div class="state">\n' +
                        '<label class="situation">' + result[i].status + '</label>\n' +
                        '</div>\n' +
                        '<div class="dele">\n' +
                        '<a href="#">删除</a>\n' +
                        '</div>\n' +
                        '<div class="pay">\n' +
                        '<a href="#">付款</a>\n' +
                        '</div>\n' +
                        '</div>\n' +
                        '</div>';
                    total = total + result[i].totalprice;

                    $('.marks').append(str);
                }
                $('.total').text(total);
            } else {
                console.log(data.message);
            }
        }
    });

        function formatLocalDate(now) {
            if(!now)
                now = new Date();
            else
                now = new Date(now);
            var tzo = -now.getTimezoneOffset(),
                dif = tzo >= 0 ? '+' : '-',
                pad = function(num) {
                    norm = Math.abs(Math.floor(num));
                    return (norm < 10 ? '0' : '') + norm;
                };
            return now.getFullYear()
                + '-' + pad(now.getMonth()+1)
                + '-' + pad(now.getDate())
                + ' ' + pad(now.getHours())
                + ':' + pad(now.getMinutes())
                + ':' + pad(now.getSeconds());
        };

</script>

</html>